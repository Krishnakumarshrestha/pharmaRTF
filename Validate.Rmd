---
title: "pharmaRTF Validation Report"
author: "Eli Miller"
date: "`r Sys.Date()`"
output:
  pdf_document:
    includes:
      in_header: header.tex
header-includes:
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \usepackage{float}
- \fancyhead[CO, CE]{The Header - Atorus}
- \fancyfoot[CO, CE]{The footer - Atorus \thepage}
---
\newpage
\tableofcontents
\newpage
```{r setup, include=FALSE}
library(dplyr)
library(testthat)
library(here)
library(knitr)
library(kableExtra)

opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = TRUE,
  echo = FALSE,
  results = "asis",
  message = FALSE,
  tidy = FALSE
)

test_code_dir <- here("vignettes", "Validation", "Test_Case_Code")
spec_dir <- here("vignettes","Validation", "Specifications")
test_case_dir <- here("vignettes","Validation", "Test_Cases")

source(here("vignettes", "helper_test_code.R")) # handles environment and access to test_that contents
source(here("vignettes", "roxy_block_details.R")) # scrapes roxygen block for authorship details
setwd("~/pharmaRTF")
```

# Validation Information
## Specifications
```{r spec_author_table}
list.files(spec_dir,
    full.names = TRUE) %>%
  lapply(., scrape_function_specification_block) %>%
  do.call(rbind, .) %>%
  kable(., col.names = c("Specification Name", "Last updated by", "Last updated date")) %>%
  kable_styling()
```

## Test case
```{r tc_author_table}
list.files(test_case_dir,
    full.names = TRUE) %>%
  lapply(., scrape_function_specification_block) %>%
  do.call(rbind, .) %>%
  kable(., col.names = c("Test Case Name", "Last updated by", "Last updated date")) %>%
  kable_styling()
```

## Test code
```{r test_code_author_table}
# test_code_author <- list.files(test_code_dir, pattern = ".R",
#                                ignore.case = TRUE, full.names = TRUE) %>%
#   lapply(., scrape_test_code_block) %>%
#   do.call(rbind, .)
# 
# cases <- stringr::str_split(test_code_author$title, pattern = "\\.", n = 2,
#                 simplify = TRUE)[,1] %>%
#   gsub(pattern = "T", replacement = "")
# 
# pack_rows_count <- sapply(unique(cases), FUN = function(x){
#   which(cases == x) %>% min
#   })
# 
# pack_rows_index <- c(pack_rows_count[-1] - pack_rows_count[-length(pack_rows_count)],
#                      length(cases) - pack_rows_count[length(pack_rows_count)] + 1) %>%
#   magrittr::set_names(paste0("T", stringr::str_pad(unique(cases), width = 3,
#                                                    side = "left", pad = 0)))
# 
# test_code_author %>%
#   kable(., col.names = c("Test Code Name", "Last updated by", "Last updated date"),
#         escape = FALSE) %>%
#   kable_styling()
```

***
# Validation Results
## General
### 1 General Specification
```{r spec_1}
scrape_spec_rmd(file.path(spec_dir, "specification_001.Rmd"))
```

### General Specification Test Cases
```{r test_case_1, out.width='0.5\\textwidth'}
scrape_spec_rmd(file.path(test_case_dir, "test_case_001.Rmd"))
```

### General Specification Test Code Results
```{r spec_function_1}
eval_test_code(file.path(test_code_dir, "test_case_001.R")) 
```

***
## RTF Document Characteristics
### 2 RTF Document Properties
```{r spec_2}
scrape_spec_rmd(file.path(spec_dir, "specification_002.Rmd"))
```

### RTF Document Characteristics Test Cases
```{r test_case_2, out.width='0.5\\textwidth'}
scrape_spec_rmd(file.path(test_case_dir, "test_case_002.Rmd"))
```

### RTF Document Characteristics Test Code Results
```{r spec_function_2}
eval_test_code(file.path(test_code_dir, "test_case_002.R")) 
```

***
## Titles and Footnotes
### 3 Titles and Footnotes Specification
```{r spec_3}
scrape_spec_rmd(file.path(spec_dir, "specification_003.Rmd"))
```

### Titles and Footnotes Test Cases

### Titles and Footnotes Test Code Results

***
## Table Level Properties
### 4 Table Level Properties Specifications
```{r spec_4}
scrape_spec_rmd(file.path(spec_dir, "specification_004.Rmd"))
```

### Table Level Properties Test Cases

### Table Level Properties Test Code Results

***
# System information
```{r sys_info}
sessionInfo()
```
